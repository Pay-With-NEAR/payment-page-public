"use strict";(self.webpackChunknearpay_donate=self.webpackChunknearpay_donate||[]).push([[523],{143:function(e,n,r){r.r(n),r.d(n,{default:function(){return $}});var a=r(9824),t=r.n(a),i=r(8214),c=r(5861),s=r(8963),l=r(2645),o=function(){var e,n=window.near,r=function(){var e=(0,c.Z)((0,i.Z)().mark((function e(r,a,t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.signAndSendTransaction({receiverId:a,actions:[{methodName:"ft_transfer",args:{receiver_id:t,amount:r},gas:s.DEFAULT_FUNCTION_CALL_GAS,deposit:1}]}));case 1:case"end":return e.stop()}}),e)})));return function(n,r,a){return e.apply(this,arguments)}}(),a=function(e,n){if(e.response.error){var r,a;(0,l.A)(null!==(r=null===(a=e.response.error.kind)||void 0===a?void 0:a.ExecutionError)&&void 0!==r?r:"Contract error")}else{var t="".concat(window.location.origin,"/payment/").concat(n.paymentId,"/pending");window.location.href=t}};return{isAvailable:null!==(e=null===n||void 0===n?void 0:n.isSender)&&void 0!==e&&e,pay:function(){var e=(0,c.Z)((0,i.Z)().mark((function e(t,c){var s,o,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&!1!==n.isSender){e.next=2;break}return e.abrupt("return");case 2:if(!1!==n.isSignedIn()){e.next=5;break}return e.next=5,n.requestSignIn({contractId:"usn"});case 5:e.t0=t.ticker,e.next="NEAR"===e.t0?8:"USN"===e.t0?13:19;break;case 8:return e.next=10,n.sendMoney({receiverId:c.address,amount:c.amount});case 10:return s=e.sent,a(s,c),e.abrupt("return");case 13:return o=(1e18*+c.displayAmountUsd).toString(),e.next=16,r(o,"usn",c.address);case 16:return d=e.sent,a(d,c),e.abrupt("return");case 19:return(0,l.A)("This ticker is not supported yet"),e.abrupt("return");case 21:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}()}},d=r(8767),u=r(4443),p=r(184),h=t()("pay-with-near-agreement"),m=function(e){var n=e.className;return(0,p.jsxs)("div",{className:h.mix(n),children:["By continuing, you agree to this"," ",(0,p.jsx)("a",{href:"https://nearpay.co/privacy_policy",target:"_blank",rel:"noopener noreferrer",children:"privacy policy"})," ","and"," ",(0,p.jsx)("a",{href:"https://nearpay.co/terms_of_use",target:"_blank",rel:"noopener noreferrer",children:"terms of service"})]})},f=r(885),x=r(8683),v=r(4925),y=r(1694),j=r.n(y),N=r(2791),g=["disabled","children","loading","className","withArrow","loadingText","icon"];function b(e){var n=e.disabled,r=e.loading;return n?"ProceedButton--disabled":r?"ProceedButton--loading":"ProceedButton--active"}var k=(0,N.forwardRef)((function(e,n){var r=e.disabled,a=void 0!==r&&r,t=e.children,i=e.loading,c=void 0!==i&&i,s=e.className,l=(e.withArrow,e.loadingText),o=e.icon,d=(0,v.Z)(e,g),u=b({disabled:a,loading:c});return(0,p.jsxs)("button",(0,x.Z)((0,x.Z)({ref:n,className:j()("ProceedButton",u,s),disabled:a},d),{},{children:[c&&l?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{}),(0,p.jsx)("span",{children:l}),(0,p.jsx)("span",{})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{}),(0,p.jsx)("span",{children:t}),(0,p.jsx)("span",{})]}),o&&(0,p.jsx)("div",{className:"ProceedButton__icon",children:o})]}))})),w=r(948),_=["label","slotAfterInput","slotRight","slotAfterLabel","children","error","size","textSize","className","placeholder"];function C(e){var n=e.label,r=e.slotAfterInput,a=e.slotRight,t=e.slotAfterLabel,i=e.children,c=e.error,s=(e.size,e.textSize,e.className),l=(e.placeholder,(0,v.Z)(e,_));if(r&&a)throw Error("Only one of after input slots can be used");return(0,p.jsxs)("label",(0,x.Z)((0,x.Z)({className:j()("Input",c?"Input--hasError":"",s)},l),{},{children:[(0,p.jsxs)("div",{className:"flex",children:[(0,p.jsxs)("div",{className:"flex-grow",children:[(0,p.jsxs)("div",{className:"Input__header",children:[(0,p.jsx)("div",{className:"Input__label",children:n}),t]}),(0,p.jsxs)("div",{className:"Input__wrapper",children:["function"===typeof i?i({inputClass:"Input__input"}):i,r?(0,p.jsx)("div",{className:"Input__after",children:r}):null]})]}),a?(0,p.jsx)("div",{className:"Input__afterCentered",children:a}):null]}),c?(0,p.jsx)("div",{className:"Input__error",children:c}):null]}))}var S=["icon","className","transform","size","children"];function A(e){e.icon;var n=e.className,r=e.transform,a=e.size,t=e.children,i=(0,v.Z)(e,S),c=function(e){if(!e)return"";for(var n=[],r=0,a=Object.entries(e);r<a.length;r++){var t=(0,f.Z)(a[r],2),i=t[0],c=t[1];n.push("".concat(i,"(").concat(c,")"))}return n.join(",")}(r||{});return(0,p.jsx)("i",(0,x.Z)((0,x.Z)({className:j()("pay-with-near-icon",n),style:{transform:c,width:a,height:a}},i),{},{children:t}))}var Z=["currency","options","className","disabled","onCurrencySelectClick"];function I(e){var n=e.currency,r=e.options,a=e.className,t=e.disabled,i=e.onCurrencySelectClick,c=(0,v.Z)(e,Z),s=(0,N.useState)(!1),l=(0,f.Z)(s,2),o=l[0],d=l[1],h=(0,N.useCallback)((function(){d((function(e){return!e}))}),[]),m=(0,N.useCallback)((function(e){h(),i(e)}),[]);return(0,p.jsx)("div",(0,x.Z)((0,x.Z)({className:j()("CurrencySelect",t?"CurrencySelect--disabled":"",a)},c),{},{children:Boolean(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i))?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(A,{className:"CurrencySelect__icon",children:(0,p.jsx)("img",{src:n.logoUrl,alt:n.viewedTicker})}),(0,p.jsx)("select",{className:"CurrencySelect__select",onChange:function(e){return i(e.target.value)},children:null===r||void 0===r?void 0:r.map((function(e){return(0,p.jsx)("option",{value:e.ticker,children:e.ticker},e.ticker)}))})]}):(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{className:"CurrencySelect__container",children:[(0,p.jsxs)("button",{className:"CurrencySelect__button",onClick:h,children:[(0,p.jsx)(A,{className:"CurrencySelect__icon",children:(0,p.jsx)("img",{src:n.logoUrl,alt:n.viewedTicker})}),(0,p.jsx)("div",{className:"CurrencySelect__text",children:n.ticker}),(0,p.jsx)(A,{size:20,className:"CurrencySelect__arrow",children:(0,p.jsx)(u.UL,{})})]}),o&&(0,p.jsx)("ul",{className:"CurrencySelect__list",children:null===r||void 0===r?void 0:r.map((function(e){return(0,p.jsxs)("li",{className:"CurrencySelect__item",onClick:function(){return m(e.ticker)},children:[(0,p.jsx)(A,{className:"CurrencySelect__icon",children:(0,p.jsx)("img",{src:e.logoUrl,alt:e.ticker})}),e.ticker]},e.ticker)}))})]})})}))}var E=["onInput","value","label","onValueChange","onCurrencySelectClick","error","selectDisabled","inputDisabled","currency","currencies","isLoading"];function P(e){var n=e.onInput,r=e.value,a=e.label,t=e.onValueChange,i=e.onCurrencySelectClick,c=e.error,s=e.selectDisabled,l=e.inputDisabled,o=e.currency,d=e.currencies,u=e.isLoading,h=void 0!==u&&u,m=(0,v.Z)(e,E),f=o.symbol;return(0,p.jsx)(C,(0,x.Z)((0,x.Z)({label:a,error:c,slotAfterInput:(0,p.jsx)(I,{currency:o,onCurrencySelectClick:s?function(){}:i,disabled:!!s,options:d})},m),{},{children:h?(0,p.jsx)("input",{disabled:!0,readOnly:!0}):(0,p.jsx)(w.Z,{thousandSeparator:!1,prefix:f,onValueChange:t,allowLeadingZeros:!0,decimalScale:o.roundOff,onInput:n,value:r,placeholder:"0.00",readOnly:l})}))}var U=["className"];function L(e){var n=e.className,r=(0,v.Z)(e,U);return(0,p.jsx)("div",(0,x.Z)({className:j()("WidgetContainer",n)},r))}var T=r(7892),R=r.n(T),z=(0,a.block)("pay-with-near-pay-timer"),D=function(e){var n=e.expiryAt,r=e.onExpired,a=(0,N.useState)(B(n)),t=(0,f.Z)(a,2),i=t[0],c=t[1];return(0,N.useEffect)((function(){B(n)<0&&r();var e=setTimeout((function(){c(B(n))}),1e3);return function(){return clearTimeout(e)}}),[i,n,r]),B(n)<0?null:(0,p.jsx)("div",{className:z(),children:O(i)})},B=function(e){var n=R()(e),r=R().utc();return n.diff(r)},O=function(e){var n=Math.floor(e/6e4),r=e%6e4,a=Math.floor(r/1e3);return"".concat(n,":").concat(a>9?a:"0".concat(a))},W=r(6009),F=(0,a.block)("pay-with-near-pay-widget"),M=(0,a.block)("pay-with-near-pay-widget-description"),V=function(e){var n,r=e.payment,a=e.defaultCurrency,t=e.onPay,i=e.onSenderWallet,c=e.onExpired,s=e.currencies,l=e.hasSenderWallet,o=(0,N.useState)(),d=(0,f.Z)(o,2),h=d[0],m=d[1],x=(0,N.useCallback)((function(e){var n=null===s||void 0===s?void 0:s.find((function(n){return n.ticker===e}));m(n)}),[s]);return(0,p.jsxs)(L,{className:F(),children:[(0,p.jsx)("div",{className:F("title"),children:r.name}),(0,p.jsx)("div",{className:F("description"),children:r.description}),(0,p.jsxs)("div",{className:M(),children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:M("label"),children:"Payment: "}),(0,p.jsx)("div",{children:r.paymentId})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:M("label"),children:"Recipient: "}),(0,p.jsx)("div",{className:M("address"),children:r.address})]})]}),(0,p.jsx)(D,{expiryAt:r.expiryAt,onExpired:c}),(0,p.jsx)(P,{label:"Amount to Pay",value:r[(n=(null===h||void 0===h?void 0:h.parameter)||(null===a||void 0===a?void 0:a.parameter),n.toLowerCase().replace(/([-_][a-z])/g,(function(e){return e.toUpperCase().replace("-","").replace("_","")})))],currency:h||a,onValueChange:function(){},onCurrencySelectClick:x,selectDisabled:!1,currencies:s,className:"mb-4"}),(0,p.jsx)(k,{onClick:function(){return t(h||a)},children:"Pay with NEAR wallet"}),l&&(0,p.jsx)(k,{onClick:function(){return i(h||a)},children:"Pay with Sender Wallet"}),(0,p.jsx)("div",{className:F("or"),children:"or"}),(0,p.jsx)("div",{className:F("qr-code-container"),children:(0,p.jsx)(W.tv,{value:"".concat(r.address,"?amount=").concat(r.displayAmount)})}),(0,p.jsx)("div",{className:F("payment-method-text"),children:"Scan following\xa0QR code with your wallet or\xa0enter Account\xa0ID\xa0and amount manually."}),(0,p.jsxs)("a",{href:"http://nearpay.co",target:"_blank",rel:"noopener noreferrer",className:j()(F("link-nearpay")),children:[(0,p.jsx)("span",{className:F("link-nearpay_gray"),children:"Powered by"}),"  ",(0,p.jsx)(u.v5,{className:F("link-nearpay_icon"),width:"20",height:"15"}),"  ",(0,p.jsx)("span",{children:"NearPay"})]})]})},X=r(6871),q=r(2419),G=r(9933),Q=r(4967),H=r(1591),J="".concat(window.location.origin,"/payment"),K=function(e){var n=e.near,r=e.payment;return r?n.isAuthorized?function(e){switch(e.ticker){case"NEAR":var a=(0,Q.M)(+r.displayAmount);if(!a||!r.address)throw new Error("Data is empty");n.send(a,r.address,"".concat(J,"/").concat(r.paymentId,"/pending"));break;case"USN":var t=1e18*+r.displayAmountUsd;if(!t||!r.address)throw new Error("Data is empty");n.ftTransfer(""+t,"usn",r.address,"".concat(J,"/").concat(r.paymentId,"/pending"));break;default:throw new Error("Unsupported currency")}}:function(){return n.login({successUrl:"".concat(J,"/").concat(r.paymentId,"/send"),failureUrl:"".concat(J,"/").concat(r.paymentId,"/failure")})}:function(){throw new Error("Payment is empty")}},Y=(0,a.block)("pay-with-near-payment-page");var $=function(){var e=function(){var e=(0,X.UO)().id,n=(0,q.ZP)("currencies",(function(){return G.i6.fetchCurrencies(e)})),r=(0,H.V)(),a=r.payment,t=r.isExpired,i=r.handleExpired,c=(0,Q.T)(),s=K({near:c,payment:null!==a&&void 0!==a?a:null}),l=(0,N.useMemo)((function(){var e;return null===(e=n.data)||void 0===e?void 0:e.find((function(e){return e.ticker===d.N.defaultCurrency}))}),[n]);return{isExpired:t,isLoaded:!!n.data&&(!!a||t)&&c.isReady,payment:a,currencies:n.data,defaultCurrency:l,handlerPay:s,handleExpired:i}}(),n=e.defaultCurrency,r=e.payment,a=e.isLoaded,t=e.isExpired,i=e.handlerPay,c=e.handleExpired,s=e.currencies,l=o();return a?t?(0,p.jsxs)(u.RX,{className:Y(),children:[(0,p.jsx)("span",{className:Y("message"),children:"This payment link is expired"}),(0,p.jsx)("a",{className:Y("link"),href:d.N.payWithNearUrl,children:"Back to shop"})]}):r&&n?(0,p.jsxs)(u.RX,{children:[(0,p.jsx)(V,{payment:r,hasSenderWallet:l.isAvailable,onSenderWallet:function(e){return l.pay(e,r)},defaultCurrency:n,currencies:s,onExpired:c,onPay:i}),(0,p.jsx)(m,{})]}):null:(0,p.jsx)(u.RX,{children:(0,p.jsx)(u.zL,{children:(0,p.jsx)(u.aN,{})})})}}}]);
//# sourceMappingURL=523.fffe5984.chunk.js.map